<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>3D Maze Game with Monster</title>
    <style>
      html, body {
        margin: 0;
        height: 100%;
        overflow: hidden;
        background: black;
      }
      #info {
        position: absolute;
        top: 10px;
        width: 100%;
        text-align: center;
        color: white;
        font-family: sans-serif;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <div id="info">Use W A S D to move | Move mouse to look | Space = Attack</div>

    <!-- Three.js and PointerLock controls -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/controls/PointerLockControls.js"></script>

    <script>
      let camera, scene, renderer, controls;
      let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
      let velocity = new THREE.Vector3();
      let direction = new THREE.Vector3();
      let monster, swordSwing = false;

      init();
      animate();

      function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // sky blue

        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        controls = new THREE.PointerLockControls(camera, document.body);
        document.body.addEventListener('click', () => controls.lock());
        scene.add(controls.getObject());

        // Ground
        const groundGeo = new THREE.PlaneGeometry(1000, 1000);
        const groundMat = new THREE.MeshBasicMaterial({ color: 0x888888 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        scene.add(ground);

        // Maze walls
        const wallGeo = new THREE.BoxGeometry(10, 10, 10);
        const wallMat = new THREE.MeshBasicMaterial({ color: 0x0033aa });
        for (let i = 0; i < 50; i++) {
          const wall = new THREE.Mesh(wallGeo, wallMat);
          wall.position.set((Math.random() - 0.5) * 400, 5, (Math.random() - 0.5) * 400);
          scene.add(wall);
        }

        // Monster
        const monsterGeo = new THREE.BoxGeometry(8, 8, 8);
        const monsterMat = new THREE.MeshBasicMaterial({ color: 0xff0000 });
        monster = new THREE.Mesh(monsterGeo, monsterMat);
        monster.position.set(0, 4, -50);
        scene.add(monster);

        // Controls
        const onKeyDown = (e) => {
          switch (e.code) {
            case 'ArrowUp':
            case 'KeyW': moveForward = true; break;
            case 'ArrowLeft':
            case 'KeyA': moveLeft = true; break;
            case 'ArrowDown':
            case 'KeyS': moveBackward = true; break;
            case 'ArrowRight':
            case 'KeyD': moveRight = true; break;
            case 'Space': swordSwing = true; break;
          }
        };
        const onKeyUp = (e) => {
          switch (e.code) {
            case 'ArrowUp':
            case 'KeyW': moveForward = false; break;
            case 'ArrowLeft':
            case 'KeyA': moveLeft = false; break;
            case 'ArrowDown':
            case 'KeyS': moveBackward = false; break;
            case 'ArrowRight':
            case 'KeyD': moveRight = false; break;
            case 'Space': swordSwing = false; break;
          }
        };

        document.addEventListener('keydown', onKeyDown);
        document.addEventListener('keyup', onKeyUp);

        window.addEventListener('resize', () => {
          camera.aspect = window.innerWidth / window.innerHeight;
          camera.updateProjectionMatrix();
          renderer.setSize(window.innerWidth, window.innerHeight);
        });
      }

      function animate() {
        requestAnimationFrame(animate);

        if (controls.isLocked) {
          const delta = 0.1;
          velocity.x -= velocity.x * 10.0 * delta;
          velocity.z -= velocity.z * 10.0 * delta;

          direction.z = Number(moveForward) - Number(moveBackward);
          direction.x = Number(moveRight) - Number(moveLeft);
          direction.normalize();

          if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
          if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;

          controls.moveRight(-velocity.x * delta);
          controls.moveForward(-velocity.z * delta);

          // Monster movement
          const playerPos = controls.getObject().position;
          const monsterDir = new THREE.Vector3().subVectors(playerPos, monster.position).normalize();
          monster.position.addScaledVector(monsterDir, 0.2);

          // Attack monster
          const dist = playerPos.distanceTo(monster.position);
          if (swordSwing && dist < 10) {
            scene.remove(monster);
          }
        }

        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
